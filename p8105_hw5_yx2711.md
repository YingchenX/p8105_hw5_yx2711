p8105_hw5_yx2711
================
Yingchen Xu
2022-11-15

# Problem 1

Use the `list.files()` function to create the dataframe containing all
file names. Use the `map()` function to iterate file names, read in the
data, and save the result as `full_df`.

``` r
full_df = 
  tibble(
    files = list.files("hw5_data/data/"),
    path = str_c("hw5_data/data/", files)
  ) %>% 
  mutate(data = map(path, read_csv)) %>% 
  unnest()
```

Tidy the results using `mutate()` and `pivot_longer()`.

``` r
tidy_df = 
  full_df %>% 
  mutate(
    files = str_replace(files, ".csv", ""),
    group = str_sub(files, 1, 3)) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "outcome",
    names_prefix = "week_") %>% 
  mutate(week = as.numeric(week)) %>% 
  select(group, subj = files, week, outcome)
```

Make a spaghetti plot showing each subject overtime.

``` r
tidy_df %>% 
  ggplot(aes(x = week, y = outcome, group = subj, color = group)) + 
  geom_point() + 
  geom_path() + 
  facet_grid(~group)
```

<img src="p8105_hw5_yx2711_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

There is a within-subject correlation. Subjects in the control groups do
not have a specific trend in change overtime, while subjects in the
experimental group have a linear increase in general.

# Problem 2

``` r
homicide = read.csv("data/homicide-data.csv") %>% 
  janitor::clean_names() 
```

The raw dataset contain 52179 observations and 12 variables. The key
variables are uid, reported_date, victims’ names, race, age, sex, city,
state, longitude and latitude, and one disposition variable indicating
the arrest status of the victims. The raw dataset summarizes homicides
data in 28 states and 50 cities.

Use `mutate()` to create the new variable `city_state` and recode the
possible typo of `Tulsa, AL` to `Tulsa, OK`. Create the summary table of
the total number of homicides and the number of unsolved homicides.

``` r
homicide = homicide %>% 
  mutate(
    city_state = str_c(city, ", ", state),
    city_state = recode(city_state, "Tulsa, AL" = "Tulsa, OK")
  )


summary = homicide %>% 
  group_by(city_state) %>% 
  summarize(
    total_number = n(),
    total_unsolved = sum(disposition %in% c("Closed without arrest", "Open/No arrest")
  ))

summary %>% knitr::kable()
```

| city_state         | total_number | total_unsolved |
|:-------------------|-------------:|---------------:|
| Albuquerque, NM    |          378 |            146 |
| Atlanta, GA        |          973 |            373 |
| Baltimore, MD      |         2827 |           1825 |
| Baton Rouge, LA    |          424 |            196 |
| Birmingham, AL     |          800 |            347 |
| Boston, MA         |          614 |            310 |
| Buffalo, NY        |          521 |            319 |
| Charlotte, NC      |          687 |            206 |
| Chicago, IL        |         5535 |           4073 |
| Cincinnati, OH     |          694 |            309 |
| Columbus, OH       |         1084 |            575 |
| Dallas, TX         |         1567 |            754 |
| Denver, CO         |          312 |            169 |
| Detroit, MI        |         2519 |           1482 |
| Durham, NC         |          276 |            101 |
| Fort Worth, TX     |          549 |            255 |
| Fresno, CA         |          487 |            169 |
| Houston, TX        |         2942 |           1493 |
| Indianapolis, IN   |         1322 |            594 |
| Jacksonville, FL   |         1168 |            597 |
| Kansas City, MO    |         1190 |            486 |
| Las Vegas, NV      |         1381 |            572 |
| Long Beach, CA     |          378 |            156 |
| Los Angeles, CA    |         2257 |           1106 |
| Louisville, KY     |          576 |            261 |
| Memphis, TN        |         1514 |            483 |
| Miami, FL          |          744 |            450 |
| Milwaukee, wI      |         1115 |            403 |
| Minneapolis, MN    |          366 |            187 |
| Nashville, TN      |          767 |            278 |
| New Orleans, LA    |         1434 |            930 |
| New York, NY       |          627 |            243 |
| Oakland, CA        |          947 |            508 |
| Oklahoma City, OK  |          672 |            326 |
| Omaha, NE          |          409 |            169 |
| Philadelphia, PA   |         3037 |           1360 |
| Phoenix, AZ        |          914 |            504 |
| Pittsburgh, PA     |          631 |            337 |
| Richmond, VA       |          429 |            113 |
| Sacramento, CA     |          376 |            139 |
| San Antonio, TX    |          833 |            357 |
| San Bernardino, CA |          275 |            170 |
| San Diego, CA      |          461 |            175 |
| San Francisco, CA  |          663 |            336 |
| Savannah, GA       |          246 |            115 |
| St. Louis, MO      |         1677 |            905 |
| Stockton, CA       |          444 |            266 |
| Tampa, FL          |          208 |             95 |
| Tulsa, OK          |          584 |            193 |
| Washington, DC     |         1345 |            589 |

The above table summarizes within cities the total number of homicides
indicating by `total_number` and the number of unsolved homicides
indicating by `total_unsolved`.

Use `prop.test()` function to estimate the proportion of unsolved
homicides in Baltimore, MD.

``` r
baltimore_test = prop.test(
    summary %>% filter(city_state == "Baltimore, MD") %>% pull(total_unsolved),
    summary %>% filter(city_state == "Baltimore, MD") %>% pull(total_number)
    ) %>% 
  broom::tidy()

baltimore_test %>% 
  select(estimate, conf.low, conf.high) %>% 
  knitr::kable(digits = 3)
```

| estimate | conf.low | conf.high |
|---------:|---------:|----------:|
|    0.646 |    0.628 |     0.663 |

The estimate of proportion of homicides that are unsolved in Baltimore
is 0.6455607 (95% CI: 0.6275625 to 0.6631599).

Write a `function(x)` for repeating the process of prop.test.

``` r
prop_test = function(x){
  
  summary = x %>% 
  group_by(city_state) %>% 
  summarize(
    total_number = n(),
    total_unsolved = sum(disposition %in% c("Closed without arrest", "Open/No arrest")
  ))
  
  city_test = prop.test(
    summary %>% pull(total_unsolved),
    summary %>% pull(total_number)
    ) %>% 
  broom::tidy()
  
  city_test
  
}
```

Nesting the unrelated columns. Map the nested data to the function
`prop_test` to iterate the process of proportional testing.

``` r
homicide_nest = homicide %>%
  nest(data = uid:city_state)


##### Mapping unsuccessful. Need to work on it later.
# homicide_test = homicide_nest %>% 
#  mutate(test = map(data, prop_test)) %>% 
#  unnest() %>% 
#  broom::tidy() %>% 
#  select(estimate, conf.low, conf.high) %>% 
#  knitr::kable(digits = 3)
```

Create a plot that shows the estimates and CI for each city

``` r
homicide_test %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  labs(
    title = "The estimates and CIs for proportion of unsolved homicides for each city",
    x = "City, State",
    y = "Estimate Proportion")
```

Need interpretation of graph.

# Problem 3

First write down the function to simulate data from a normal
distribution, run a t.test, and return the estimates of t-statistics and
p-value.

``` r
t_test = function(n = 30, mu, sigma = 5) {
  
  x = rnorm(n, mean = mu, sd = sigma)
  
  
  t_test =
    t.test(x, mu = 0) %>% 
    broom::tidy() 
  
  t_test %>% 
    select(estimate, p.value)
  
}
```

Then, generate 5000 datasets from `rnorm()` and run the `t_test` for mu
= 0. Save the resulting estimate and p-value as `sim_mu0_df`.

``` r
sim_mu0_df = 
  expand_grid(
    true_mu = 0,
    iter = 1:5000
  ) %>% 
  mutate(
    estimate_df = map(.x = true_mu, ~ t_test(mu = .x))
  ) %>% 
  unnest()
```
